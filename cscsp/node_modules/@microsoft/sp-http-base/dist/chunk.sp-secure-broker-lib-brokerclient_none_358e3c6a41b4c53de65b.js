(window.webpackJsonp_8496636c_2300_4915_abef_20de64c98d8b_1_16_1=window.webpackJsonp_8496636c_2300_4915_abef_20de64c98d8b_1_16_1||[]).push([[8],{oWJm:function(e,t,n){"use strict";n.r(t),n.d(t,"_BrokerClient",function(){return s});var a=n("17wl"),i=n("UWqr"),r=n("2q6Q"),o="https://securebroker.sharepointonline.com",s=function(){function e(){}return e.getAuthToken=function(t,n,a){void 0===a&&(a=!1);var o=new r._QosMonitor("BrokerClient.getAuthToken",!0),s=window.location.origin.split(".")[0];s=s.substring(s.lastIndexOf("-app"));var c=!!i.Guid.tryParse(s.substring(s.length-36));return e._ensureBrokerWindow(a).then(function(i){return e._getAuthToken(t,i,n,a)}).then(function(t){return t?(o.writeSuccess({isIsolated:c}),a&&(e._brokerClientPerfMarks.SSBBrokerLogonGetAuthTokenEnd=Date.now()),Promise.resolve(t)):Promise.reject("UndefinedAuthToken")}).catch(function(e){return o.writeUnexpectedFailure(e,new Error(e),{isIsolated:c}),Promise.reject("BrokerClient.getAuthToken Rejected: ".concat(e))})},e.getPerfMarks=function(){return e._ensureBrokerWindow().then(function(t){return e._getPerfMarks(t)}).then(function(t){var n=Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},t),e._brokerClientPerfMarks),e._firstBrokerLoginLoadPerfMarks);return Promise.resolve(n)}).catch(function(e){return Promise.reject("BrokerClient.getPerformanceMarks reject: ".concat(e))})},e.logPerformance=function(t,n){e._ensureBrokerWindow().then(function(i){var r=Object(a.__assign)(Object(a.__assign)({},e._brokerClientPerfMarks),t);0===Object.keys(e._firstBrokerLoginLoadPerfMarks).length&&(e._firstBrokerLoginLoadPerfMarks=t);var o={action:"logPerfMarkers",marks:r,error:n};i.postMessage(o,e._TARGET_ORIGIN_OPTION),e._brokerClientPerfMarks={}}).catch(function(e){})},e.initializeBrokerClient=function(){this._ensureBrokerWindow().catch(function(e){})},e._getAuthToken=function(t,n,a,i){void 0===i&&(i=!1);var r,o={action:"requestToken",claims:a,resource:t,identifier:e._messageIdentifier};i&&(e._brokerClientPerfMarks.SSBBrokerLogonRequestTokenStart=Date.now());var s=new Promise(function(t,n){var a=e._messageIdentifier++;e._getAuthTokenResolvers.set(a,{reject:n,resolve:t,timeout:r})});return n.postMessage(o,e._TARGET_ORIGIN_OPTION),Promise.race([s,new Promise(function(e,t){r=setTimeout(function(){t("GetAuthTokenTimeout")},1e4)})])},e._getPerfMarks=function(t){e._getPerfMarksPromise=new Promise(function(t){e._getPerfMarksResolver=t});return t.postMessage({action:"getPerfMarkers"},e._TARGET_ORIGIN_OPTION),e._getPerfMarksAndTimeOutPromise=Promise.race([e._getPerfMarksPromise,new Promise(function(t,n){e._getPerfMarksTimeOutPromise=setTimeout(function(){n("GetPerfMarkersTimeout")},1e4)})]),e._getPerfMarksAndTimeOutPromise},e._ensureBrokerWindow=function(t){if(void 0===t&&(t=!1),t&&(e._brokerClientPerfMarks.SSBBrokerLogonFindBrokerWindowStart=Date.now()),!e._secureBrokerWindowAndTimeOutPromise){e._secureBrokerWindowPromise=new Promise(function(t){e._secureBrokerWindowResolver=t}),e._ensureMessageHandlers();for(var n=window,a={action:"getBrokerWindow",isBrokerLoginLoad:t};n!==n.parent;)n.parent.postMessage(a,o),n=n.parent;e._secureBrokerWindowAndTimeOutPromise=Promise.race([e._secureBrokerWindowPromise,new Promise(function(t,n){e._timeOutPromise=setTimeout(function(){n("EnsureBrokerWindowTimeout")},1e4)})])}return e._secureBrokerWindowAndTimeOutPromise},e._ensureMessageHandlers=function(){e._messageHandlersAdded||(window.addEventListener("message",e._handleMessage),e._messageHandlersAdded=!0)},e._handleMessage=function(t){if(t.origin&&t.data&&t.origin===o)if("ackBrokerWindow"===t.data.action)clearTimeout(e._timeOutPromise),e._secureBrokerWindowResolver(t.source),t.data.isBrokerLoginLoad&&(e._brokerClientPerfMarks.SSBBrokerLogonFindBrokerWindowSuccess=Date.now());else if("returnToken"===t.data.action){var n=t.data,a=e._getAuthTokenResolvers.get(n.requestIdentifier);clearTimeout(a.timeout),a.resolve(n.result)}else if("rejectToken"===t.data.action||"errorOriginDoesNotMatchRequestedToken"===t.data.action)n=t.data,a=e._getAuthTokenResolvers.get(n.requestIdentifier),clearTimeout(a.timeout),a.reject("".concat(t.data.action,": ").concat(t.data.error,"}"));else if("returnPerfMarkers"===t.data.action){var i=t.data.marks;clearTimeout(e._getPerfMarksTimeOutPromise),e._getPerfMarksResolver(i)}},e._TARGET_ORIGIN_OPTION={targetOrigin:o},e._messageIdentifier=0,e._getAuthTokenResolvers=new Map,e._brokerClientPerfMarks={},e._firstBrokerLoginLoadPerfMarks={},e}()}}]);